{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# ExpressRoute Workbook\r\n\r\n### *Below you will find useful details about your ExpressRoute circuit like health status of your ExpressRoute circuits, linked resources with their status and key metrics*  "
      },
      "name": "text - 0"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::selected"
        ],
        "parameters": [
          {
            "id": "679870c3-3f4e-4b5d-b525-184cd820ebbc",
            "version": "KqlParameterItem/1.0",
            "name": "ExpressRouteCircuit",
            "label": "ExpressRoute",
            "type": 5,
            "value": null,
            "typeSettings": {
              "resourceTypeFilter": {
                "Microsoft.Network/expressRouteCircuits": true,
                "microsoft.network/expressroutecircuits": true
              },
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "c3a4c244-1738-4165-8359-3f6766fe4051",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "value": {
              "durationMs": 3600000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ]
            }
          },
          {
            "id": "9cb59013-e850-4c57-817a-0602e0656aa8",
            "version": "KqlParameterItem/1.0",
            "name": "ERGateway",
            "type": 5,
            "query": "Resources\r\n| where type =~ 'Microsoft.network/expressroutecircuits'\r\n| where id =~ '{ExpressRouteCircuit}'\r\n//| where name =~ 'Cust12-VNet1-ER'\r\n| extend p = parse_json(properties)\r\n| extend peeringID = tostring(p.peerings[0].id) \r\n| project peeringID\r\n| join kind=leftouter (\r\nresources\r\n| where type =~ 'Microsoft.network/expressroutegateways'\r\n| extend ERGateway = id\r\n| extend p = parse_json(properties)\r\n| extend test = p.provisioningState, peeringID = tostring(p.expressRouteConnections[0].properties.expressRouteCircuitPeering.id), Gatewayname = name, ProvisioningState = p.provisioningState \r\n| project Gatewayname, location, ProvisioningState, peeringID, ERGateway\r\n) on peeringID\r\n//| project-away peeringID, peeringID1\r\n| project ERGateway, selected = 1",
            "crossComponentResources": [
              "{ExpressRouteCircuit}"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "parameters - 1"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureHealthQuery/1.0\",\"queryType\":\"Detailed\"}",
        "size": 4,
        "title": "ExpressRoute health status",
        "queryType": 4,
        "resourceType": "microsoft.network/expressroutecircuits",
        "crossComponentResources": [
          "{ExpressRouteCircuit}"
        ],
        "gridSettings": {
          "rowLimit": 1
        }
      },
      "name": "ExpressRoute health status"
    },
    {
      "type": 1,
      "content": {
        "json": "## Linked Resources"
      },
      "name": "text - 3"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\r\n| where type =~ 'Microsoft.network/expressroutecircuits'\r\n| where id =~ '{ExpressRouteCircuit}'\r\n//| where name =~ 'Cust12-VNet1-ER'\r\n| extend p = parse_json(properties)\r\n| extend peeringID = tostring(p.peerings[0].id) \r\n| project peeringID\r\n| join kind=leftouter (\r\nresources\r\n| where type =~ 'Microsoft.network/expressroutegateways'\r\n| extend p = parse_json(properties)\r\n| extend test = p.provisioningState, peeringID = tostring(p.expressRouteConnections[0].properties.expressRouteCircuitPeering.id), Gatewayname = name, ProvisioningState = p.provisioningState\r\n| project Gatewayname, location, ProvisioningState, peeringID\r\n) on peeringID\r\n| project-away peeringID, peeringID1",
        "size": 4,
        "title": "ExpressRoute Gateways",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{ExpressRouteCircuit}"
        ]
      },
      "customWidth": "50",
      "name": "query - 4"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "where type =~ 'Microsoft.network/expressroutecircuits'\r\n//| where name =~ 'Cust12-VNet1-ER'\r\n| where id =~ '{ExpressRouteCircuit}' \r\n//| extend name = tostring('{ExpressRouteCircuit}')\r\n//| project name\r\n| mvexpand properties.peerings\r\n| extend PeeringType = properties_peerings.name\r\n| extend ProvisioningState = properties_peerings.properties.provisioningState\r\n| extend State = properties_peerings.properties.state\r\n| project Circuitname = name, PeeringType, State, ProvisioningState",
        "size": 4,
        "title": "Peerings",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{ExpressRouteCircuit}"
        ]
      },
      "customWidth": "50",
      "name": "query - 5"
    },
    {
      "type": 1,
      "content": {
        "json": "## ExpressRoute Metrics"
      },
      "name": "text - 6"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "72008d32-d7c8-492d-949b-25bb6d4c2724",
            "cellValue": "TabSelected",
            "linkTarget": "parameter",
            "linkLabel": "Availability",
            "subTarget": "1",
            "style": "link"
          },
          {
            "id": "2e990bfa-afef-4051-b30a-32d851c8a739",
            "cellValue": "TabSelected",
            "linkTarget": "parameter",
            "linkLabel": "Throughput",
            "subTarget": "2",
            "style": "link"
          },
          {
            "id": "b8a3d3fa-d823-4762-8bae-395666fa640d",
            "cellValue": "TabSelected",
            "linkTarget": "parameter",
            "linkLabel": "Packet Drops",
            "subTarget": "3",
            "style": "link"
          },
          {
            "id": "b197bea8-fc98-4c11-a904-d5cfa57d4f2c",
            "cellValue": "TabSelected",
            "linkTarget": "parameter",
            "linkLabel": "Gateway Metrics",
            "subTarget": "4",
            "style": "link"
          }
        ]
      },
      "name": "links - 7"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbookcbf7a82f-e84f-496e-b57a-d38ab754c67a",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutecircuits",
        "metricScope": 0,
        "resourceParameter": "ExpressRouteCircuit",
        "resourceIds": [
          "{ExpressRouteCircuit}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 3600000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Availability-ArpAvailability",
            "aggregation": 4,
            "splitBy": null
          },
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Availability-BgpAvailability",
            "aggregation": 4
          }
        ],
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "TabSelected",
        "comparison": "isEqualTo",
        "value": "1"
      },
      "name": "metric - 8"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook899a0cf0-3bf6-42e9-b7a0-9cc601354712",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutecircuits",
        "metricScope": 0,
        "resourceParameter": "ExpressRouteCircuit",
        "resourceIds": [
          "{ExpressRouteCircuit}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 3600000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Traffic-BitsInPerSecond",
            "aggregation": 4,
            "splitBy": null
          },
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Traffic-BitsOutPerSecond",
            "aggregation": 4
          }
        ],
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "TabSelected",
        "comparison": "isEqualTo",
        "value": "2"
      },
      "name": "metric - 9"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook19f9cf84-113b-4af2-8556-6201c32a36ec",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutecircuits",
        "metricScope": 0,
        "resourceParameter": "ExpressRouteCircuit",
        "resourceIds": [
          "{ExpressRouteCircuit}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 3600000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Traffic-BitsInPerSecond",
            "aggregation": 4,
            "splitBy": null
          },
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Traffic-BitsOutPerSecond",
            "aggregation": 4
          }
        ],
        "title": "Primary Connection traffic ",
        "filters": [
          {
            "id": "1",
            "key": "DeviceRole",
            "operator": 0,
            "values": [
              "Primary"
            ]
          }
        ],
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "TabSelected",
        "comparison": "isEqualTo",
        "value": "2"
      },
      "customWidth": "50",
      "name": "metric - 12"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbookca3e1c87-41cc-4bde-aa92-ab3bd0a54290",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutecircuits",
        "metricScope": 0,
        "resourceParameter": "ExpressRouteCircuit",
        "resourceIds": [
          "{ExpressRouteCircuit}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 3600000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Traffic-BitsInPerSecond",
            "aggregation": 4,
            "splitBy": null
          },
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Traffic-BitsOutPerSecond",
            "aggregation": 4
          }
        ],
        "title": "Secondary Connection traffic",
        "filters": [
          {
            "id": "2",
            "key": "DeviceRole",
            "operator": 0,
            "values": [
              "secondary"
            ]
          }
        ],
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "TabSelected",
        "comparison": "isEqualTo",
        "value": "2"
      },
      "customWidth": "50",
      "name": "metric - 13"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook8751db2a-79e4-4ebb-bac6-13896ad3229e",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutecircuits",
        "metricScope": 0,
        "resourceParameter": "ExpressRouteCircuit",
        "resourceIds": [
          "{ExpressRouteCircuit}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 3600000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Traffic-BitsInPerSecond",
            "aggregation": 4,
            "splitBy": null
          },
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Traffic-BitsOutPerSecond",
            "aggregation": 4
          }
        ],
        "title": "Private Peering Traffic",
        "filters": [
          {
            "id": "1",
            "key": "PeeringType",
            "operator": 0,
            "values": [
              "private"
            ]
          }
        ],
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "TabSelected",
        "comparison": "isEqualTo",
        "value": "2"
      },
      "customWidth": "50",
      "name": "metric - 14"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook7e0e3d8c-4bd8-4deb-85f2-6bee1f806365",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutecircuits",
        "metricScope": 0,
        "resourceParameter": "ExpressRouteCircuit",
        "resourceIds": [
          "{ExpressRouteCircuit}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 3600000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Traffic-BitsInPerSecond",
            "aggregation": 4,
            "splitBy": null
          },
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Traffic-BitsOutPerSecond",
            "aggregation": 4
          }
        ],
        "title": "Public peering traffic",
        "filters": [
          {
            "id": "1",
            "key": "PeeringType",
            "operator": 1,
            "values": [
              "private"
            ]
          }
        ],
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "TabSelected",
        "comparison": "isEqualTo",
        "value": "2"
      },
      "customWidth": "50",
      "name": "metric - 15"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbooke20f8946-66e3-4760-972d-9384a019ee49",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutecircuits",
        "metricScope": 0,
        "resourceParameter": "ExpressRouteCircuit",
        "resourceIds": [
          "{ExpressRouteCircuit}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 3600000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Qos-QosDropBitsInPerSecond",
            "aggregation": 4,
            "splitBy": null
          },
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Qos-QosDropBitsOutPerSecond",
            "aggregation": 4
          }
        ],
        "title": "Dropped Bits",
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "TabSelected",
        "comparison": "isEqualTo",
        "value": "3"
      },
      "name": "metric - 10"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook96d693a1-5fb8-4a9a-8327-f56d0d4248d3",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutecircuits",
        "metricScope": 0,
        "resourceParameter": "ExpressRouteCircuit",
        "resourceIds": [
          "{ExpressRouteCircuit}"
        ],
        "timeContext": {
          "durationMs": 3600000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Availability-ArpAvailability",
            "aggregation": 4,
            "splitBy": null,
            "columnName": "ARP - Primary ",
            "filters": [
              {
                "key": "Peer",
                "operator": 0,
                "values": [
                  "Primary-IPv4"
                ]
              }
            ]
          },
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Availability-BgpAvailability",
            "aggregation": 4,
            "columnName": "BGP - Primary",
            "filters": [
              {
                "key": "Peer",
                "operator": 0,
                "values": [
                  "Primary-IPv4"
                ]
              }
            ]
          }
        ],
        "title": "Primary Connection ",
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "TabSelected",
        "comparison": "isEqualTo",
        "value": "1"
      },
      "customWidth": "50",
      "name": "metric - 16"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbookbb98633e-9861-4d0b-b5ea-6c2e614c9a80",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutecircuits",
        "metricScope": 0,
        "resourceParameter": "ExpressRouteCircuit",
        "resourceIds": [
          "{ExpressRouteCircuit}"
        ],
        "timeContext": {
          "durationMs": 3600000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Availability-ArpAvailability",
            "aggregation": 4,
            "splitBy": null,
            "columnName": "ARP  - Secondary",
            "filters": [
              {
                "key": "Peer",
                "operator": 0,
                "values": [
                  "Secondary-IPv4"
                ]
              }
            ]
          },
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Circuit Availability-BgpAvailability",
            "aggregation": 4,
            "columnName": "BGP - Secondary",
            "filters": [
              {
                "key": "Peer",
                "operator": 0,
                "values": [
                  "Secondary-IPv4"
                ]
              }
            ]
          }
        ],
        "title": "Secondary Connection ",
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "TabSelected",
        "comparison": "isEqualTo",
        "value": "1"
      },
      "customWidth": "50",
      "name": "metric - 17"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook42e364a9-4e49-4431-bd8b-3af72cfdc3a4",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutegateways",
        "metricScope": 0,
        "resourceParameter": "ERGateway",
        "resourceIds": [
          "{ERGateway}"
        ],
        "timeContext": {
          "durationMs": 3600000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutegateways",
            "metric": "microsoft.network/expressroutegateways-Traffic-ErGatewayConnectionBitsInPerSecond",
            "aggregation": 4,
            "splitBy": null
          },
          {
            "namespace": "microsoft.network/expressroutegateways",
            "metric": "microsoft.network/expressroutegateways-Traffic-ErGatewayConnectionBitsOutPerSecond",
            "aggregation": 4
          }
        ],
        "title": "Gateway Throughput",
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "TabSelected",
        "comparison": "isEqualTo",
        "value": "4"
      },
      "name": "metric - 18"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}